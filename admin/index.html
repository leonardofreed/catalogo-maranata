<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Gerenciamento de Produtos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .admin-nav {
            background: #34495e;
            padding: 15px 30px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: transparent;
            color: white;
            border: 2px solid #3498db;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .nav-btn:hover, .nav-btn.active {
            background: #3498db;
            transform: translateY(-2px);
        }

        .content {
            padding: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
            font-weight: 500;
        }
        
        /* Estilos para o gerenciamento de produtos */
        .section {
            display: none;
            margin-top: 20px;
        }
        
        .section.active {
            display: block;
        }
        
        /* Configura√ß√µes sempre vis√≠vel quando selecionada */
        #settings-section {
            display: block !important;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background: #d35400;
        }
        
        .produtos-lista {
            margin-top: 30px;
            border-collapse: collapse;
            width: 100%;
        }
        
        .produtos-lista th, 
        .produtos-lista td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .produtos-lista th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .produtos-lista tr:hover {
            background-color: #f1f1f1;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .produto-imagem {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
        }

        .formulario-container {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .formulario-container h3 {
            color: #2c3e50;
            margin-bottom: 25px;
            text-align: center;
            font-size: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
            font-size: 16px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .products-table th,
        .products-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .products-table th {
            background: #34495e;
            color: white;
            font-weight: 600;
        }

        .products-table tr:hover {
            background: #f8f9fa;
        }

        .product-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }

        .actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Configura√ß√µes */
        .settings-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .settings-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .settings-card h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 18px;
        }

        .settings-card p {
            color: #666;
            margin-bottom: 20px;
        }

        .settings-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .settings-form .form-group {
            display: flex;
            flex-direction: column;
        }

        .settings-form label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }

        .settings-form input,
        .settings-form textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .settings-form textarea {
            resize: vertical;
            min-height: 120px;
        }

        .settings-form small {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
        }

        .info-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .status-indicator {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-indicator.configurado {
            background: #d4edda;
            color: #155724;
        }

        .status-indicator.nao-configurado {
            background: #f8d7da;
            color: #721c24;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        @media (max-width: 768px) {
            .settings-container {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #7f8c8d;
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .success {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .hidden {
            display: none;
        }

        /* Modal de edi√ß√£o */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 20px 20px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .modal-body {
            padding: 30px;
        }

        /* A√ß√µes em lote */
        .bulk-actions {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 15px;
        }

        .bulk-actions.show {
            display: flex;
        }

        .bulk-actions span {
            font-weight: 600;
            color: #2c3e50;
        }

        .bulk-actions .btn {
            padding: 8px 16px;
            font-size: 14px;
        }

        .product-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .select-all-checkbox {
            margin-right: 10px;
        }

        /* Menu hamb√∫rguer para mobile */
        .mobile-menu-toggle {
            display: none;
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .mobile-menu-toggle:hover {
            background: #2980b9;
        }

        .admin-nav.mobile-hidden {
            display: none;
        }

        /* Melhorias para formul√°rios mobile */
        .formulario-container {
            margin-bottom: 20px;
        }

        .formulario-container h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
        }

        /* Melhorias para modais mobile */
        .modal {
            padding: 10px;
        }

        .modal-content {
            border-radius: 15px;
        }

        /* Melhorias para bot√µes mobile */
        .btn {
            min-height: 44px; /* Tamanho m√≠nimo para touch */
        }

        .btn-small {
            min-height: 36px;
        }

        /* Melhorias para inputs mobile */
        .form-control {
            min-height: 44px;
            font-size: 16px; /* Evita zoom no iOS */
        }

        /* Melhorias para checkboxes mobile */
        .product-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .select-all-checkbox {
            width: 24px;
            height: 24px;
        }

        .auth-section {
            text-align: center;
            padding: 50px;
        }

        .auth-input {
            padding: 15px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            width: 300px;
            margin: 10px;
        }

        .auth-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            margin: 10px;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 10px;
                margin: 0;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .mobile-menu-toggle {
                display: block;
            }
            
            .admin-nav {
                flex-direction: column;
                padding: 15px;
                gap: 10px;
            }
            
            .admin-nav.mobile-hidden {
                display: none;
            }
            
            .nav-btn {
                padding: 12px 15px;
                font-size: 14px;
                text-align: center;
            }
            
            .content {
                padding: 20px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-card h3 {
                font-size: 1.5rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-buttons {
                flex-direction: column;
            }
            
            .products-table {
                font-size: 12px;
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            .products-table thead,
            .products-table tbody,
            .products-table tr,
            .products-table th,
            .products-table td {
                display: block;
            }
            
            .products-table thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            
            .products-table tr {
                border: 1px solid #ccc;
                margin-bottom: 10px;
                padding: 15px;
                border-radius: 10px;
                background: white;
                box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                display: block;
            }
            
            .products-table td {
                border: none;
                position: relative;
                padding: 8px 0;
                padding-left: 50%;
                text-align: left;
            }
            
            .products-table td:before {
                content: attr(data-label);
                position: absolute;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
                color: #2c3e50;
            }
            
            .products-table td[data-label="Imagem"] {
                text-align: center;
                padding: 10px 0;
            }
            
            .products-table td[data-label="Imagem"]:before {
                display: none;
            }
            
            .products-table .product-image {
                width: 80px;
                height: 80px;
                border-radius: 10px;
            }
            
            .actions {
                flex-direction: column;
                gap: 5px;
            }
            
            .btn-small {
                padding: 8px 12px;
                font-size: 11px;
                width: 100%;
            }
            
            .bulk-actions {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .bulk-actions .btn {
                width: 100%;
                margin: 2px 0;
            }
            
            .modal-content {
                margin: 10px;
                max-height: 95vh;
                width: calc(100% - 20px);
            }
            
            .modal-header {
                padding: 20px;
            }
            
            .modal-header h3 {
                font-size: 1.2rem;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .modal-body .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .modal-body .form-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .modal-body .btn {
                width: 100%;
            }
            
            .auth-input {
                width: 100%;
                max-width: 300px;
            }
            
            .auth-btn {
                width: 100%;
                max-width: 300px;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card h3 {
                font-size: 1.3rem;
            }
            
            .products-table td {
                padding-left: 40%;
            }
            
            .products-table td:before {
                width: 35%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Painel Administrativo</h1>
            <p>quase24horas.top - Gerenciamento de Produtos</p>
        </div>

        <!-- Se√ß√£o de Autentica√ß√£o -->
        <div id="auth-section" class="auth-section">
            <h3>üîê Acesso Administrativo</h3>
            <p>Digite o token de acesso:</p>
            <input type="password" id="auth-token" class="auth-input" placeholder="Token de acesso">
            <br>
            <button onclick="authenticate()" class="auth-btn">Entrar</button>
            <p style="margin-top: 20px; color: #7f8c8d; font-size: 14px;">
                Token padr√£o: admin123
            </p>
        </div>

        <!-- Conte√∫do Principal -->
        <div id="main-content" class="hidden">
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">‚ò∞ Menu</button>
            <div class="admin-nav" id="admin-nav">
                <button class="nav-btn active" onclick="showSection('dashboard')">üìä Dashboard</button>
                <button class="nav-btn" onclick="showSection('products')">üì¶ Produtos</button>
                <button class="nav-btn" onclick="showSection('add-product')">‚ûï Adicionar</button>
                <button class="nav-btn" onclick="showSection('bulk-import')">üì• Importar</button>
                <button class="nav-btn" onclick="showSection('cep-ranges')">üöö Faixas CEP</button>
                <button class="nav-btn" onclick="showSection('settings')">‚öôÔ∏è Configura√ß√µes</button>
                <button class="nav-btn" onclick="logout()">üö™ Sair</button>
            </div>

            <div class="content">
                <!-- Dashboard -->
                <div id="dashboard-section">
                    <h2>üìä Estat√≠sticas do Cat√°logo</h2>
                    <div class="stats-grid" id="stats-grid">
                        <!-- Estat√≠sticas ser√£o carregadas aqui -->
                    </div>
                </div>

                <!-- Lista de Produtos -->
                <div id="products-section" class="hidden">
                    <h2>üì¶ Gerenciar Produtos</h2>
                    
                    <!-- A√ß√µes em lote -->
                    <div id="bulk-actions" class="bulk-actions">
                        <span id="selected-count">0 produtos selecionados</span>
                        <button onclick="bulkDelete()" class="btn btn-danger">üóëÔ∏è Deletar Selecionados</button>
                        <button onclick="bulkUpdateStock()" class="btn btn-warning">üì¶ Atualizar Estoque</button>
                        <button onclick="bulkChangeCategory()" class="btn btn-info">üìÇ Alterar Categoria</button>
                        <button onclick="clearSelection()" class="btn">‚ùå Limpar Sele√ß√£o</button>
                    </div>
                    
                    <div id="products-loading" class="loading">Carregando produtos...</div>
                    <div id="products-error" class="error hidden"></div>
                    <table class="products-table" id="products-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="select-all" class="select-all-checkbox" onchange="toggleSelectAll()"></th>
                                <th>ID</th>
                                <th>Imagem</th>
                                <th>Nome</th>
                                <th>Categoria</th>
                                <th>Pre√ßo</th>
                                <th>Estoque</th>
                                <th>Criado</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="products-tbody">
                            <!-- Produtos ser√£o carregados aqui -->
                        </tbody>
                    </table>
                </div>

                <!-- Adicionar Produto -->
                <div id="add-product-section" class="hidden">
                    <div class="formulario-container">
                        <h3>‚ûï Adicionar Novo Produto</h3>
                        <form id="add-product-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="nome">Nome do Produto *</label>
                                    <input type="text" id="nome" name="nome" required>
                                </div>
                                <div class="form-group">
                                    <label for="categoria">Categoria *</label>
                                    <select id="categoria" name="categoria" required>
                                        <option value="">Selecione uma categoria</option>
                                        <option value="Eletr√¥nicos">Eletr√¥nicos</option>
                                        <option value="Inform√°tica">Inform√°tica</option>
                                        <option value="Roupas">Roupas</option>
                                        <option value="Cal√ßados">Cal√ßados</option>
                                        <option value="Livros">Livros</option>
                                        <option value="Eletrodom√©sticos">Eletrodom√©sticos</option>
                                        <option value="Acess√≥rios">Acess√≥rios</option>
                                        <option value="Casa e Jardim">Casa e Jardim</option>
                                        <option value="Esportes">Esportes</option>
                                        <option value="Beleza">Beleza</option>
                                        <option value="Outros">Outros</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="preco">Pre√ßo (R$) *</label>
                                    <input type="number" id="preco" name="preco" step="0.01" min="0" required>
                                </div>
                                <div class="form-group">
                                    <label for="estoque">Estoque</label>
                                    <input type="number" id="estoque" name="estoque" min="0" value="0">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="descricao">Descri√ß√£o</label>
                                <textarea id="descricao" name="descricao" rows="3" placeholder="Descreva o produto..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="imagem_url">URL da Imagem</label>
                                <input type="url" id="imagem_url" name="imagem_url" placeholder="https://exemplo.com/imagem.jpg">
                            </div>
                            
                            <div class="form-buttons">
                                <button type="submit" class="btn">üíæ Salvar Produto</button>
                                <button type="button" class="btn btn-danger" onclick="clearForm()">üóëÔ∏è Limpar</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Importa√ß√£o em Lote -->
                <div id="bulk-import-section" class="hidden">
                    <div class="formulario-container">
                        <h3>üì• Importa√ß√£o em Lote</h3>
                        <p>Cole o JSON com os produtos para importar:</p>
                        <textarea id="bulk-json" rows="10" placeholder='[
  {
    "nome": "Produto 1",
    "descricao": "Descri√ß√£o do produto 1",
    "preco": 99.99,
    "categoria": "Categoria",
    "estoque": 10,
    "imagem_url": "https://exemplo.com/imagem1.jpg"
  },
  {
    "nome": "Produto 2",
    "descricao": "Descri√ß√£o do produto 2",
    "preco": 149.99,
    "categoria": "Categoria",
    "estoque": 5,
    "imagem_url": "https://exemplo.com/imagem2.jpg"
  }
]'></textarea>
                        <div class="form-buttons">
                            <button onclick="bulkImport()" class="btn btn-info">üì• Importar Produtos</button>
                            <button onclick="clearBulkForm()" class="btn btn-danger">üóëÔ∏è Limpar</button>
                        </div>
                    </div>
                </div>

                <!-- Gerenciamento de Faixas de CEP -->
                <div id="cep-ranges-section" class="hidden">
                    <h2>üöö Gerenciar Faixas de CEP</h2>
                    
                    <!-- Formul√°rio para adicionar/editar faixa de CEP -->
                    <div class="formulario-container">
                        <h3 id="cep-form-title">‚ûï Adicionar Nova Faixa de CEP</h3>
                        <form id="cep-range-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cep-nome">Nome da Regi√£o *</label>
                                    <input type="text" id="cep-nome" name="nome" required placeholder="Ex: S√£o Paulo Capital">
                                </div>
                                <div class="form-group">
                                    <label for="cep-ativo">Status</label>
                                    <select id="cep-ativo" name="ativo">
                                        <option value="1">Ativo</option>
                                        <option value="0">Inativo</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cep-inicio">CEP In√≠cio *</label>
                                    <input type="text" id="cep-inicio" name="cep_inicio" required placeholder="01000-000" maxlength="9" pattern="[0-9]{5}-[0-9]{3}">
                                </div>
                                <div class="form-group">
                                    <label for="cep-fim">CEP Fim *</label>
                                    <input type="text" id="cep-fim" name="cep_fim" required placeholder="05999-999" maxlength="9" pattern="[0-9]{5}-[0-9]{3}">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cep-valor">Valor do Frete (R$) *</label>
                                    <input type="number" id="cep-valor" name="valor_frete" step="0.01" min="0" required placeholder="15.00">
                                </div>
                                <div class="form-group">
                                    <!-- Campo removido conforme solicitado -->
                                </div>
                            </div>
                            
                            <div class="form-buttons">
                                <button type="submit" class="btn">üíæ Salvar Faixa</button>
                                <button type="button" class="btn btn-danger" onclick="clearCepForm()">üóëÔ∏è Limpar</button>
                                <button type="button" class="btn btn-warning" onclick="cancelCepEdit()" id="cancel-edit-btn" style="display: none;">‚ùå Cancelar Edi√ß√£o</button>
                            </div>
                        </form>
                    </div>

                    <!-- Lista de faixas de CEP -->
                    <div style="margin-top: 30px;">
                        <h3>üìã Faixas de CEP Cadastradas</h3>
                        <div id="cep-loading" class="loading">Carregando faixas de CEP...</div>
                        <div id="cep-error" class="error hidden"></div>
                        
                        <table class="products-table" id="cep-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Regi√£o</th>
                                    <th>CEP In√≠cio</th>
                                    <th>CEP Fim</th>
                                    <th>Valor Frete</th>
                                    <th>Status</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="cep-tbody">
                                <!-- Faixas de CEP ser√£o carregadas aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Configura√ß√µes -->
                <div id="settings-section" class="section">
                    <h2>‚öôÔ∏è Configura√ß√µes do Sistema</h2>
                    
                    <div class="settings-container">
                        <div class="settings-card">
                            <h3>üì± WhatsApp para Pedidos</h3>
                            <p>Configure o n√∫mero do WhatsApp para receber os pedidos dos clientes.</p>
                            
                            <form id="whatsapp-form" class="settings-form">
                                <div class="form-group">
                                    <label for="whatsapp-number">N√∫mero do WhatsApp *</label>
                                    <input type="text" id="whatsapp-number" name="whatsapp_number" 
                                           placeholder="5511999999999" required 
                                           pattern="[0-9]{10,15}" 
                                           title="Digite o n√∫mero com c√≥digo do pa√≠s (ex: 5511999999999)"
                                           style="border: 2px solid #e1e5e9; padding: 12px; border-radius: 8px; font-size: 16px;">
                                    <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">
                                        üì± <strong>Formato:</strong> c√≥digo do pa√≠s + DDD + n√∫mero<br>
                                        ‚úÖ <strong>Exemplo:</strong> 5511999999999 (Brasil)<br>
                                        ‚ùå <strong>N√£o use:</strong> (11) 99999-9999 ou +55 11 99999-9999
                                    </small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="whatsapp-message">Mensagem Padr√£o</label>
                                    <textarea id="whatsapp-message" name="whatsapp_message" rows="4" 
                                              placeholder="Digite aqui sua mensagem padr√£o para os pedidos...">Ol√°! Recebi um novo pedido atrav√©s do site:

üõí *Resumo do Pedido:*
{resumo_pedido}

üí∞ *Total: R$ {total}*

üì¶ *Itens:*
{itens}

üöö *Frete: R$ {frete}*

üìç *CEP: {cep}*

Por favor, confirme o pedido e informe a forma de pagamento.

Obrigado!</textarea>
                                </div>
                                
                                <div class="form-buttons">
                                    <button type="submit" class="btn" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);">
                                        üíæ Salvar Configura√ß√µes
                                    </button>
                                    <button type="button" class="btn btn-info" onclick="testWhatsApp()" style="background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);">
                                        üì± Testar WhatsApp
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <div class="settings-card">
                            <h3>‚ÑπÔ∏è Informa√ß√µes</h3>
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>Status:</strong>
                                    <span id="whatsapp-status" class="status-indicator">N√£o configurado</span>
                                </div>
                                <div class="info-item">
                                    <strong>√öltima atualiza√ß√£o:</strong>
                                    <span id="whatsapp-last-update">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o de Produto -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Editar Produto</h3>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-product-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-nome">Nome do Produto *</label>
                            <input type="text" id="edit-nome" name="nome" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-categoria">Categoria *</label>
                            <select id="edit-categoria" name="categoria" required>
                                <option value="">Selecione uma categoria</option>
                                <option value="Eletr√¥nicos">Eletr√¥nicos</option>
                                <option value="Inform√°tica">Inform√°tica</option>
                                <option value="Roupas">Roupas</option>
                                <option value="Cal√ßados">Cal√ßados</option>
                                <option value="Livros">Livros</option>
                                <option value="Eletrodom√©sticos">Eletrodom√©sticos</option>
                                <option value="Acess√≥rios">Acess√≥rios</option>
                                <option value="Casa e Jardim">Casa e Jardim</option>
                                <option value="Esportes">Esportes</option>
                                <option value="Beleza">Beleza</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-preco">Pre√ßo (R$) *</label>
                            <input type="number" id="edit-preco" name="preco" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-estoque">Estoque</label>
                            <input type="number" id="edit-estoque" name="estoque" min="0" value="0">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-descricao">Descri√ß√£o</label>
                        <textarea id="edit-descricao" name="descricao" rows="3" placeholder="Descreva o produto..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-imagem_url">URL da Imagem</label>
                        <input type="url" id="edit-imagem_url" name="imagem_url" placeholder="https://exemplo.com/imagem.jpg">
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" class="btn">üíæ Salvar Altera√ß√µes</button>
                        <button type="button" class="btn btn-danger" onclick="closeEditModal()">‚ùå Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de A√ß√µes em Lote -->
    <div id="bulk-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="bulk-modal-title">A√ß√£o em Lote</h3>
                <button class="modal-close" onclick="closeBulkModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="bulk-modal-content">
                    <!-- Conte√∫do ser√° inserido dinamicamente -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let authToken = null;

        // Autentica√ß√£o
        function authenticate() {
            const token = document.getElementById('auth-token').value;
            if (token === 'admin123') {
                authToken = token;
                document.getElementById('auth-section').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                loadDashboard();
            } else {
                alert('Token inv√°lido!');
            }
        }

        function logout() {
            authToken = null;
            document.getElementById('auth-section').classList.remove('hidden');
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('auth-token').value = '';
        }

        // Navega√ß√£o
        function showSection(sectionId) {
            // Esconder todas as se√ß√µes
            document.querySelectorAll('[id$="-section"]').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Mostrar se√ß√£o selecionada
            const targetSection = document.getElementById(sectionId + '-section');
            if (targetSection) {
                targetSection.classList.remove('hidden');
                // For√ßar exibi√ß√£o da se√ß√£o de configura√ß√µes
                if (sectionId === 'settings') {
                    targetSection.style.display = 'block';
                }
            }
            
            // Atualizar bot√µes de navega√ß√£o
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Fechar menu mobile ap√≥s sele√ß√£o
            if (window.innerWidth <= 768) {
                document.getElementById('admin-nav').classList.add('mobile-hidden');
            }

            // Carregar dados da se√ß√£o
            if (sectionId === 'dashboard') {
                loadDashboard();
            } else if (sectionId === 'products') {
                loadProducts();
            } else if (sectionId === 'cep-ranges') {
                loadCepRanges();
            } else if (sectionId === 'settings') {
                console.log('Carregando configura√ß√µes...');
                loadSettings();
            }
        }

        // Menu mobile
        function toggleMobileMenu() {
            const nav = document.getElementById('admin-nav');
            nav.classList.toggle('mobile-hidden');
        }

        // Dashboard
        async function loadDashboard() {
            try {
                const response = await fetch('/admin/api/stats', {
                    headers: {
                        'Authorization': 'Bearer ' + authToken
                    }
                });
                const stats = await response.json();
                
                document.getElementById('stats-grid').innerHTML = `
                    <div class="stat-card">
                        <h3>${stats.total_produtos}</h3>
                        <p>Total de Produtos</p>
                    </div>
                    <div class="stat-card">
                        <h3>${stats.total_categorias}</h3>
                        <p>Categorias</p>
                    </div>
                    <div class="stat-card">
                        <h3>R$ ${stats.preco_medio}</h3>
                        <p>Pre√ßo M√©dio</p>
                    </div>
                    <div class="stat-card">
                        <h3>${stats.total_estoque}</h3>
                        <p>Total em Estoque</p>
                    </div>
                    <div class="stat-card">
                        <h3>R$ ${stats.preco_minimo}</h3>
                        <p>Pre√ßo M√≠nimo</p>
                    </div>
                    <div class="stat-card">
                        <h3>R$ ${stats.preco_maximo}</h3>
                        <p>Pre√ßo M√°ximo</p>
                    </div>
                    <div class="stat-card">
                        <h3>${stats.produtos_sem_estoque}</h3>
                        <p>Sem Estoque</p>
                    </div>
                `;
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
            }
        }

        // Produtos
        async function loadProducts() {
            document.getElementById('products-loading').classList.remove('hidden');
            document.getElementById('products-error').classList.add('hidden');
            
            try {
                const response = await fetch('/api/produtos');
                const produtos = await response.json();
                
                document.getElementById('products-loading').classList.add('hidden');
                
                const tbody = document.getElementById('products-tbody');
                tbody.innerHTML = produtos.map(produto => `
                    <tr>
                        <td data-label="Selecionar"><input type="checkbox" class="product-checkbox" value="${produto.id}" onchange="updateBulkActions()"></td>
                        <td data-label="ID">${produto.id}</td>
                        <td data-label="Imagem">
                            <img src="${produto.imagem_url || 'https://via.placeholder.com/60x60?text=Sem+Imagem'}" 
                                 alt="${produto.nome}" 
                                 class="product-image"
                                 onerror="this.src='https://via.placeholder.com/60x60?text=Sem+Imagem'">
                        </td>
                        <td data-label="Nome">${produto.nome}</td>
                        <td data-label="Categoria">${produto.categoria}</td>
                        <td data-label="Pre√ßo">R$ ${parseFloat(produto.preco).toFixed(2)}</td>
                        <td data-label="Estoque">${produto.estoque}</td>
                        <td data-label="Criado">${new Date(produto.data_criacao).toLocaleDateString('pt-BR')}</td>
                        <td data-label="A√ß√µes" class="actions">
                            <button onclick="editProduct(${produto.id})" class="btn btn-warning btn-small">‚úèÔ∏è Editar</button>
                            <button onclick="deleteProduct(${produto.id})" class="btn btn-danger btn-small">üóëÔ∏è Deletar</button>
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                document.getElementById('products-loading').classList.add('hidden');
                document.getElementById('products-error').classList.remove('hidden');
                document.getElementById('products-error').textContent = 'Erro ao carregar produtos: ' + error.message;
            }
        }

        // Adicionar produto
        document.getElementById('add-product-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const produto = {
                nome: formData.get('nome'),
                descricao: formData.get('descricao'),
                preco: parseFloat(formData.get('preco')),
                categoria: formData.get('categoria'),
                estoque: parseInt(formData.get('estoque')) || 0,
                imagem_url: formData.get('imagem_url')
            };

            try {
                const response = await fetch('/api/produtos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(produto)
                });

                if (response.ok) {
                    showMessage('Produto adicionado com sucesso!', 'success');
                    clearForm();
                    loadDashboard();
                } else {
                    const error = await response.json();
                    showMessage('Erro ao adicionar produto: ' + error.error, 'error');
                }
            } catch (error) {
                showMessage('Erro de conex√£o: ' + error.message, 'error');
            }
        });

        // Importa√ß√£o em lote
        async function bulkImport() {
            const jsonText = document.getElementById('bulk-json').value;
            
            try {
                const produtos = JSON.parse(jsonText);
                
                const response = await fetch('/api/bulk-import', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ produtos })
                });

                const result = await response.json();
                showMessage(`Importa√ß√£o conclu√≠da! ${result.sucessos} sucessos, ${result.erros} erros.`, 'success');
                clearBulkForm();
                loadDashboard();
            } catch (error) {
                showMessage('Erro ao importar: ' + error.message, 'error');
            }
        }

        // Deletar produto
        async function deleteProduct(id) {
            if (confirm('Tem certeza que deseja deletar este produto?')) {
                try {
                    const response = await fetch(`/api/produtos/${id}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        showMessage('Produto deletado com sucesso!', 'success');
                        loadProducts();
                        loadDashboard();
                    } else {
                        const error = await response.json();
                        showMessage('Erro ao deletar produto: ' + error.error, 'error');
                    }
                } catch (error) {
                    showMessage('Erro de conex√£o: ' + error.message, 'error');
                }
            }
        }

        // Fun√ß√µes auxiliares
        function clearForm() {
            document.getElementById('add-product-form').reset();
        }

        function clearBulkForm() {
            document.getElementById('bulk-json').value = '';
        }

        function showMessage(text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success' : 'error';
            messageDiv.textContent = text;
            
            document.querySelector('.content').insertBefore(messageDiv, document.querySelector('.content').firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        function editProduct(id) {
            // Buscar dados do produto
            fetch(`/api/produtos/${id}`)
                .then(response => response.json())
                .then(produto => {
                    // Preencher formul√°rio de edi√ß√£o
                    document.getElementById('edit-nome').value = produto.nome;
                    document.getElementById('edit-categoria').value = produto.categoria;
                    document.getElementById('edit-preco').value = produto.preco;
                    document.getElementById('edit-estoque').value = produto.estoque;
                    document.getElementById('edit-descricao').value = produto.descricao || '';
                    document.getElementById('edit-imagem_url').value = produto.imagem_url || '';
                    
                    // Armazenar ID para uso no submit
                    document.getElementById('edit-product-form').dataset.productId = id;
                    
                    // Mostrar modal
                    document.getElementById('edit-modal').classList.add('show');
                })
                .catch(error => {
                    showMessage('Erro ao carregar dados do produto: ' + error.message, 'error');
                });
        }

        function closeEditModal() {
            document.getElementById('edit-modal').classList.remove('show');
            document.getElementById('edit-product-form').reset();
        }

        // Event listener para formul√°rio de edi√ß√£o
        document.getElementById('edit-product-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const productId = this.dataset.productId;
            const formData = new FormData(e.target);
            const produto = {
                nome: formData.get('nome'),
                descricao: formData.get('descricao'),
                preco: parseFloat(formData.get('preco')),
                categoria: formData.get('categoria'),
                estoque: parseInt(formData.get('estoque')) || 0,
                imagem_url: formData.get('imagem_url')
            };

            try {
                const response = await fetch(`/api/produtos/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(produto)
                });

                if (response.ok) {
                    showMessage('Produto atualizado com sucesso!', 'success');
                    closeEditModal();
                    loadProducts();
                    loadDashboard();
                } else {
                    const error = await response.json();
                    showMessage('Erro ao atualizar produto: ' + error.error, 'error');
                }
            } catch (error) {
                showMessage('Erro de conex√£o: ' + error.message, 'error');
            }
        });

        // Fun√ß√µes para a√ß√µes em lote
        function toggleSelectAll() {
            const selectAll = document.getElementById('select-all');
            const checkboxes = document.querySelectorAll('.product-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
            
            updateBulkActions();
        }

        function updateBulkActions() {
            const checkboxes = document.querySelectorAll('.product-checkbox:checked');
            const bulkActions = document.getElementById('bulk-actions');
            const selectedCount = document.getElementById('selected-count');
            
            if (checkboxes.length > 0) {
                bulkActions.classList.add('show');
                selectedCount.textContent = `${checkboxes.length} produto(s) selecionado(s)`;
            } else {
                bulkActions.classList.remove('show');
            }
        }

        function clearSelection() {
            const checkboxes = document.querySelectorAll('.product-checkbox');
            const selectAll = document.getElementById('select-all');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            selectAll.checked = false;
            
            updateBulkActions();
        }

        function getSelectedIds() {
            const checkboxes = document.querySelectorAll('.product-checkbox:checked');
            return Array.from(checkboxes).map(checkbox => checkbox.value);
        }

        function bulkDelete() {
            const selectedIds = getSelectedIds();
            
            if (selectedIds.length === 0) {
                showMessage('Nenhum produto selecionado!', 'error');
                return;
            }
            
            if (confirm(`Tem certeza que deseja deletar ${selectedIds.length} produto(s)?`)) {
                const promises = selectedIds.map(id => 
                    fetch(`/api/produtos/${id}`, { method: 'DELETE' })
                );
                
                Promise.all(promises)
                    .then(() => {
                        showMessage(`${selectedIds.length} produto(s) deletado(s) com sucesso!`, 'success');
                        loadProducts();
                        loadDashboard();
                        clearSelection();
                    })
                    .catch(error => {
                        showMessage('Erro ao deletar produtos: ' + error.message, 'error');
                    });
            }
        }

        function bulkUpdateStock() {
            const selectedIds = getSelectedIds();
            
            if (selectedIds.length === 0) {
                showMessage('Nenhum produto selecionado!', 'error');
                return;
            }
            
            document.getElementById('bulk-modal-title').textContent = 'üì¶ Atualizar Estoque';
            document.getElementById('bulk-modal-content').innerHTML = `
                <div class="form-group">
                    <label>Novo valor de estoque para ${selectedIds.length} produto(s):</label>
                    <input type="number" id="new-stock" class="form-control" min="0" placeholder="Digite o novo valor de estoque">
                </div>
                <div class="form-buttons">
                    <button onclick="confirmBulkStockUpdate()" class="btn">üíæ Atualizar Estoque</button>
                    <button onclick="closeBulkModal()" class="btn btn-danger">‚ùå Cancelar</button>
                </div>
            `;
            
            document.getElementById('bulk-modal').classList.add('show');
        }

        function confirmBulkStockUpdate() {
            const selectedIds = getSelectedIds();
            const newStock = document.getElementById('new-stock').value;
            
            if (!newStock || newStock < 0) {
                showMessage('Valor de estoque inv√°lido!', 'error');
                return;
            }
            
            const promises = selectedIds.map(id => 
                fetch(`/api/produtos/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ estoque: parseInt(newStock) })
                })
            );
            
            Promise.all(promises)
                .then(() => {
                    showMessage(`Estoque de ${selectedIds.length} produto(s) atualizado com sucesso!`, 'success');
                    closeBulkModal();
                    loadProducts();
                    loadDashboard();
                    clearSelection();
                })
                .catch(error => {
                    showMessage('Erro ao atualizar estoque: ' + error.message, 'error');
                });
        }

        function bulkChangeCategory() {
            const selectedIds = getSelectedIds();
            
            if (selectedIds.length === 0) {
                showMessage('Nenhum produto selecionado!', 'error');
                return;
            }
            
            document.getElementById('bulk-modal-title').textContent = 'üìÇ Alterar Categoria';
            document.getElementById('bulk-modal-content').innerHTML = `
                <div class="form-group">
                    <label>Nova categoria para ${selectedIds.length} produto(s):</label>
                    <select id="new-category" class="form-control">
                        <option value="">Selecione uma categoria</option>
                        <option value="Eletr√¥nicos">Eletr√¥nicos</option>
                        <option value="Inform√°tica">Inform√°tica</option>
                        <option value="Roupas">Roupas</option>
                        <option value="Cal√ßados">Cal√ßados</option>
                        <option value="Livros">Livros</option>
                        <option value="Eletrodom√©sticos">Eletrodom√©sticos</option>
                        <option value="Acess√≥rios">Acess√≥rios</option>
                        <option value="Casa e Jardim">Casa e Jardim</option>
                        <option value="Esportes">Esportes</option>
                        <option value="Beleza">Beleza</option>
                        <option value="Outros">Outros</option>
                    </select>
                </div>
                <div class="form-buttons">
                    <button onclick="confirmBulkCategoryChange()" class="btn">üíæ Alterar Categoria</button>
                    <button onclick="closeBulkModal()" class="btn btn-danger">‚ùå Cancelar</button>
                </div>
            `;
            
            document.getElementById('bulk-modal').classList.add('show');
        }

        function confirmBulkCategoryChange() {
            const selectedIds = getSelectedIds();
            const newCategory = document.getElementById('new-category').value;
            
            if (!newCategory) {
                showMessage('Selecione uma categoria!', 'error');
                return;
            }
            
            const promises = selectedIds.map(id => 
                fetch(`/api/produtos/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ categoria: newCategory })
                })
            );
            
            Promise.all(promises)
                .then(() => {
                    showMessage(`Categoria de ${selectedIds.length} produto(s) alterada com sucesso!`, 'success');
                    closeBulkModal();
                    loadProducts();
                    loadDashboard();
                    clearSelection();
                })
                .catch(error => {
                    showMessage('Erro ao alterar categoria: ' + error.message, 'error');
                });
        }

        function closeBulkModal() {
            document.getElementById('bulk-modal').classList.remove('show');
        }

        // Event listeners para fechar modais clicando fora
        document.getElementById('edit-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditModal();
            }
        });

        document.getElementById('bulk-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeBulkModal();
            }
        });

        // ===== FUN√á√ïES PARA GERENCIAMENTO DE FAIXAS DE CEP =====
        
        let editingCepId = null;

        // Carregar faixas de CEP
        async function loadCepRanges() {
            document.getElementById('cep-loading').classList.remove('hidden');
            document.getElementById('cep-error').classList.add('hidden');
            
            try {
                const response = await fetch('/api/faixas-cep');
                const faixas = await response.json();
                
                document.getElementById('cep-loading').classList.add('hidden');
                
                const tbody = document.getElementById('cep-tbody');
                tbody.innerHTML = faixas.map(faixa => `
                    <tr>
                        <td data-label="ID">${faixa.id}</td>
                        <td data-label="Regi√£o">${faixa.nome}</td>
                        <td data-label="CEP In√≠cio">${faixa.cep_inicio}</td>
                        <td data-label="CEP Fim">${faixa.cep_fim}</td>
                        <td data-label="Valor Frete">R$ ${parseFloat(faixa.valor_frete).toFixed(2)}</td>
                        <td data-label="Status">
                            <span class="${faixa.ativo ? 'success' : 'error'}" style="padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                                ${faixa.ativo ? 'Ativo' : 'Inativo'}
                            </span>
                        </td>
                        <td data-label="A√ß√µes" class="actions">
                            <button onclick="editCepRange(${faixa.id})" class="btn btn-warning btn-small">‚úèÔ∏è Editar</button>
                            <button onclick="deleteCepRange(${faixa.id})" class="btn btn-danger btn-small">üóëÔ∏è Deletar</button>
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                document.getElementById('cep-loading').classList.add('hidden');
                document.getElementById('cep-error').classList.remove('hidden');
                document.getElementById('cep-error').textContent = 'Erro ao carregar faixas de CEP: ' + error.message;
            }
        }

        // Event listener para formul√°rio de faixa de CEP
        document.getElementById('cep-range-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const faixa = {
                nome: formData.get('nome'),
                cep_inicio: formData.get('cep_inicio'),
                cep_fim: formData.get('cep_fim'),
                valor_frete: parseFloat(formData.get('valor_frete')),
                ativo: formData.get('ativo') === '1'
            };

            // Valida√ß√µes
            const cepInicio = faixa.cep_inicio.replace(/\D/g, '');
            const cepFim = faixa.cep_fim.replace(/\D/g, '');
            
            if (cepInicio.length !== 8 || cepFim.length !== 8) {
                showMessage('CEPs devem ter 8 d√≠gitos no formato 00000-000!', 'error');
                return;
            }
            
            if (parseInt(cepInicio) > parseInt(cepFim)) {
                showMessage('CEP in√≠cio deve ser menor ou igual ao CEP fim!', 'error');
                return;
            }

            try {
                let response;
                if (editingCepId) {
                    // Atualizar faixa existente
                    response = await fetch(`/api/faixas-cep/${editingCepId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(faixa)
                    });
                } else {
                    // Criar nova faixa
                    response = await fetch('/api/faixas-cep', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(faixa)
                    });
                }

                if (response.ok) {
                    const action = editingCepId ? 'atualizada' : 'criada';
                    showMessage(`Faixa de CEP ${action} com sucesso!`, 'success');
                    clearCepForm();
                    loadCepRanges();
                } else {
                    const error = await response.json();
                    showMessage('Erro ao salvar faixa: ' + error.error, 'error');
                }
            } catch (error) {
                showMessage('Erro de conex√£o: ' + error.message, 'error');
            }
        });

        // Editar faixa de CEP
        async function editCepRange(id) {
            try {
                const response = await fetch(`/api/faixas-cep/${id}`);
                const faixa = await response.json();
                
                // Preencher formul√°rio
                document.getElementById('cep-nome').value = faixa.nome;
                document.getElementById('cep-inicio').value = faixa.cep_inicio;
                document.getElementById('cep-fim').value = faixa.cep_fim;
                document.getElementById('cep-valor').value = faixa.valor_frete;
                document.getElementById('cep-ativo').value = faixa.ativo ? '1' : '0';
                
                // Alterar interface para modo de edi√ß√£o
                editingCepId = id;
                document.getElementById('cep-form-title').textContent = '‚úèÔ∏è Editar Faixa de CEP';
                document.getElementById('cancel-edit-btn').style.display = 'inline-block';
                
                // Scroll para o formul√°rio
                document.getElementById('cep-range-form').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                showMessage('Erro ao carregar dados da faixa: ' + error.message, 'error');
            }
        }

        // Deletar faixa de CEP
        async function deleteCepRange(id) {
            if (confirm('Tem certeza que deseja deletar esta faixa de CEP?')) {
                try {
                    const response = await fetch(`/api/faixas-cep/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        showMessage('Faixa de CEP deletada com sucesso!', 'success');
                        loadCepRanges();
                    } else {
                        const error = await response.json();
                        showMessage('Erro ao deletar faixa: ' + error.error, 'error');
                    }
                } catch (error) {
                    showMessage('Erro de conex√£o: ' + error.message, 'error');
                }
            }
        }

        // Limpar formul√°rio de faixa de CEP
        function clearCepForm() {
            document.getElementById('cep-range-form').reset();
            editingCepId = null;
            document.getElementById('cep-form-title').textContent = '‚ûï Adicionar Nova Faixa de CEP';
            document.getElementById('cancel-edit-btn').style.display = 'none';
        }

        // Cancelar edi√ß√£o de faixa de CEP
        function cancelCepEdit() {
            clearCepForm();
        }

        // Valida√ß√£o de CEP em tempo real (formato brasileiro: 00000-000)
        document.getElementById('cep-inicio').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 5) {
                value = value.substring(0, 5) + '-' + value.substring(5, 8);
            }
            e.target.value = value;
        });

        document.getElementById('cep-fim').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 5) {
                value = value.substring(0, 5) + '-' + value.substring(5, 8);
            }
            e.target.value = value;
        });

        // ===== CONFIGURA√á√ïES =====
        
        // Carregar configura√ß√µes
        async function loadSettings() {
            try {
                const response = await fetch('/api/settings');
                const settings = await response.json();
                
                if (settings.whatsapp_number) {
                    document.getElementById('whatsapp-number').value = settings.whatsapp_number;
                    document.getElementById('whatsapp-message').value = settings.whatsapp_message || '';
                    
                    // Atualizar status
                    document.getElementById('whatsapp-status').textContent = 'Configurado';
                    document.getElementById('whatsapp-status').className = 'status-indicator configurado';
                    document.getElementById('whatsapp-last-update').textContent = new Date(settings.updated_at).toLocaleString('pt-BR');
                } else {
                    document.getElementById('whatsapp-status').textContent = 'N√£o configurado';
                    document.getElementById('whatsapp-status').className = 'status-indicator nao-configurado';
                    document.getElementById('whatsapp-last-update').textContent = '-';
                }
            } catch (error) {
                console.error('Erro ao carregar configura√ß√µes:', error);
                showMessage('Erro ao carregar configura√ß√µes', 'error');
            }
        }

        // Salvar configura√ß√µes do WhatsApp
        document.getElementById('whatsapp-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const settings = {
                whatsapp_number: formData.get('whatsapp_number'),
                whatsapp_message: formData.get('whatsapp_message')
            };

            // Valida√ß√£o do n√∫mero
            if (!settings.whatsapp_number || settings.whatsapp_number.length < 10) {
                showMessage('‚ùå N√∫mero do WhatsApp deve ter pelo menos 10 d√≠gitos!', 'error');
                return;
            }
            
            if (settings.whatsapp_number.length > 15) {
                showMessage('‚ùå N√∫mero do WhatsApp deve ter no m√°ximo 15 d√≠gitos!', 'error');
                return;
            }
            
            // Verificar se cont√©m apenas n√∫meros
            if (!/^\d+$/.test(settings.whatsapp_number)) {
                showMessage('‚ùå N√∫mero do WhatsApp deve conter apenas d√≠gitos!', 'error');
                return;
            }

            try {
                const response = await fetch('/api/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });

                if (response.ok) {
                    showMessage('‚úÖ Configura√ß√µes do WhatsApp salvas com sucesso! Agora voc√™ pode receber pedidos.', 'success');
                    loadSettings(); // Recarregar para mostrar status atualizado
                } else {
                    const error = await response.json();
                    showMessage('‚ùå Erro ao salvar: ' + error.error, 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar configura√ß√µes:', error);
                showMessage('Erro ao salvar configura√ß√µes', 'error');
            }
        });

        // Testar WhatsApp
        function testWhatsApp() {
            const whatsappNumber = document.getElementById('whatsapp-number').value;
            
            if (!whatsappNumber) {
                showMessage('Configure o n√∫mero do WhatsApp primeiro!', 'error');
                return;
            }

            const testMessage = 'Teste de configura√ß√£o do WhatsApp - Sistema funcionando!';
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(testMessage)}`;
            
            window.open(whatsappUrl, '_blank');
        }

        // Valida√ß√£o do n√∫mero do WhatsApp em tempo real
        document.getElementById('whatsapp-number').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            e.target.value = value;
            
            // Feedback visual
            const input = e.target;
            const isValid = value.length >= 10 && value.length <= 15;
            
            if (value.length > 0) {
                if (isValid) {
                    input.style.borderColor = '#27ae60';
                    input.style.backgroundColor = '#d4edda';
                } else {
                    input.style.borderColor = '#e74c3c';
                    input.style.backgroundColor = '#f8d7da';
                }
            } else {
                input.style.borderColor = '#e1e5e9';
                input.style.backgroundColor = 'white';
            }
        });
    </script>
</body>
</html>
